<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>JD Notes Things</title>
    <style>
      /* Prevent FOUC (Flash of Unstyled Content) */
      html {
        background-color: #1e1e1e; /* Match dark mode to prevent white flash */
      }
      body {
        visibility: hidden;
        opacity: 0;
        background-color: #1e1e1e;
      }
      body.loaded {
        visibility: visible;
        opacity: 1;
        transition: opacity 0.1s ease-in;
      }

      @keyframes slideIn {
        from {
          transform: translateX(400px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(400px);
          opacity: 0;
        }
      }
    </style>
  </head>
  <body>
    <!-- Custom Title Bar (Claude Desktop style) -->
    <div class="custom-titlebar" id="customTitlebar">
      <div class="titlebar-drag-region"></div>

      <!-- Left: Hamburger Menu -->
      <div class="titlebar-left">
        <button class="titlebar-menu-btn" id="titlebarMenuBtn" title="Menu">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </button>
        <!-- Dropdown Menu -->
        <div class="titlebar-dropdown" id="titlebarDropdown">
          <div class="titlebar-dropdown-section">
            <button class="titlebar-dropdown-item" data-menu="file">
              <span>File</span>
              <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M10 17l5-5-5-5v10z"/></svg>
            </button>
            <button class="titlebar-dropdown-item" data-menu="view">
              <span>View</span>
              <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M10 17l5-5-5-5v10z"/></svg>
            </button>
            <button class="titlebar-dropdown-item" data-menu="help">
              <span>Help</span>
              <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M10 17l5-5-5-5v10z"/></svg>
            </button>
          </div>
        </div>
        <!-- Submenu for File -->
        <div class="titlebar-submenu" id="submenu-file">
          <button class="titlebar-dropdown-item" id="menuNewMeeting">New Meeting</button>
          <button class="titlebar-dropdown-item" id="menuImport">Import Transcript...</button>
          <div class="titlebar-dropdown-divider"></div>
          <button class="titlebar-dropdown-item" id="menuSettings">Settings</button>
          <div class="titlebar-dropdown-divider"></div>
          <button class="titlebar-dropdown-item" id="menuExit">Exit</button>
        </div>
        <!-- Submenu for View -->
        <div class="titlebar-submenu" id="submenu-view">
          <button class="titlebar-dropdown-item" id="menuReload">Reload</button>
          <button class="titlebar-dropdown-item" id="menuToggleDevTools">Toggle Developer Tools</button>
          <div class="titlebar-dropdown-divider"></div>
          <button class="titlebar-dropdown-item" id="menuZoomIn">Zoom In</button>
          <button class="titlebar-dropdown-item" id="menuZoomOut">Zoom Out</button>
          <button class="titlebar-dropdown-item" id="menuResetZoom">Reset Zoom</button>
        </div>
        <!-- Submenu for Help -->
        <div class="titlebar-submenu" id="submenu-help">
          <button class="titlebar-dropdown-item" id="menuAbout">About</button>
          <button class="titlebar-dropdown-item" id="menuGitHub">GitHub Repository</button>
          <button class="titlebar-dropdown-item" id="menuCheckUpdates">Check for Updates</button>
        </div>
      </div>

      <!-- Center: App Title -->
      <div class="titlebar-center">
        <span class="titlebar-title" id="titlebarTitle">JD Notes Things</span>
      </div>

      <!-- Right: Window Controls -->
      <div class="titlebar-right">
        <button class="titlebar-btn" id="minimizeBtn" title="Minimize">
          <svg width="12" height="12" viewBox="0 0 12 12">
            <rect width="10" height="1" x="1" y="6" fill="currentColor"/>
          </svg>
        </button>
        <button class="titlebar-btn" id="maximizeBtn" title="Maximize">
          <svg width="12" height="12" viewBox="0 0 12 12">
            <rect width="9" height="9" x="1.5" y="1.5" fill="none" stroke="currentColor" stroke-width="1"/>
          </svg>
        </button>
        <button class="titlebar-btn titlebar-btn-close" id="closeBtn" title="Close">
          <svg width="12" height="12" viewBox="0 0 12 12">
            <path d="M1 1l10 10M11 1L1 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="app-container">
      <div id="mainView" style="display: block;">
      <!-- Compact Toolbar - Option 4 Design -->
      <header class="toolbar" id="drag-region">
        <!-- Fixed-width left section for consistent layout -->
        <div class="toolbar-left" id="toolbarLeft">
          <button class="toolbar-icon-btn" id="backButton" title="Back" style="display: none;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" fill="currentColor"/>
            </svg>
          </button>
          <button class="toolbar-icon-btn" id="homeButton" title="Home" style="visibility: hidden;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" fill="currentColor"/>
            </svg>
          </button>
        </div>

        <!-- Search Box -->
        <div class="toolbar-search">
          <svg class="toolbar-search-icon" width="17" height="17" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15.5 14H14.71L14.43 13.73C15.41 12.59 16 11.11 16 9.5C16 5.91 13.09 3 9.5 3C5.91 3 3 5.91 3 9.5C3 13.09 5.91 16 9.5 16C11.11 16 12.59 15.41 13.73 14.43L14 14.71V15.5L19 20.49L20.49 19L15.5 14ZM9.5 14C7.01 14 5 11.99 5 9.5C5 7.01 7.01 5 9.5 5C11.99 5 14 7.01 14 9.5C14 11.99 11.99 14 9.5 14Z" fill="currentColor"/>
          </svg>
          <input type="text" class="toolbar-search-input" placeholder="Search..." aria-label="Search meetings">
        </div>

        <!-- Saved Views Selector (v1.2) -->
        <div class="views-container">
          <select class="views-select" id="viewsSelect" title="Saved Views">
            <option value="">All Meetings</option>
          </select>
        </div>

        <!-- Filter Button with Dropdown (v1.2) -->
        <div class="filter-dropdown-container">
          <button class="toolbar-filter-btn" id="filterToggleBtn" title="Filter meetings">
            <svg class="toolbar-filter-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
            </svg>
          </button>
          <div class="filter-dropdown-panel" id="filterDropdown">
            <div class="filter-dropdown-header">
              <span>Filters</span>
              <button class="filter-clear-btn" id="filterClearAll" title="Clear all filters">Clear</button>
            </div>
            <div class="filter-dropdown-body">
              <!-- Company Filter -->
              <div class="filter-group">
                <label class="filter-label">Company</label>
                <select class="filter-select" id="filterCompany">
                  <option value="">All Companies</option>
                </select>
              </div>
              <!-- Contact Filter -->
              <div class="filter-group">
                <label class="filter-label">Contact</label>
                <select class="filter-select" id="filterContact">
                  <option value="">All Contacts</option>
                </select>
              </div>
              <!-- Platform Filter -->
              <div class="filter-group">
                <label class="filter-label">Platform</label>
                <select class="filter-select" id="filterPlatform">
                  <option value="">All Platforms</option>
                  <option value="zoom">Zoom</option>
                  <option value="teams">Microsoft Teams</option>
                  <option value="google-meet">Google Meet</option>
                  <option value="in-person">In-Person</option>
                  <option value="webex">Webex</option>
                  <option value="unknown">Unknown</option>
                </select>
              </div>
              <!-- Sync Status Filter -->
              <div class="filter-group">
                <label class="filter-label">Sync Status</label>
                <select class="filter-select" id="filterSyncStatus">
                  <option value="">All</option>
                  <option value="synced">Synced to Obsidian</option>
                  <option value="not-synced">Not Synced</option>
                </select>
              </div>
            </div>
            <div class="filter-dropdown-footer">
              <button class="filter-save-view-btn" id="filterSaveView">Save as View</button>
            </div>
          </div>
        </div>

        <!-- v1.2: Recording Widget Toggle Button -->
        <button class="toolbar-icon-btn" id="toggleWidgetBtn" title="Toggle Recording Widget">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
            <circle cx="12" cy="12" r="4" fill="currentColor"/>
          </svg>
        </button>

        <!-- Spacer -->
        <div class="toolbar-spacer"></div>

        <!-- Primary Action - Quick Record (In-Person) -->
        <button class="toolbar-btn toolbar-btn-primary" id="newNoteBtn" title="Quick Record (In-Person Meeting)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z" fill="currentColor"/>
            <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" fill="currentColor"/>
          </svg>
          <span>Quick</span>
        </button>

        <!-- Secondary Action - Meeting (Platform-Aware) -->
        <button class="toolbar-btn toolbar-btn-secondary" id="joinMeetingBtn" title="Record Meeting (No meeting detected)" disabled>
          <!-- Platform icon container - dynamically updated -->
          <span class="toolbar-platform-icon" id="meetingPlatformIcon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z" fill="currentColor"/>
            </svg>
          </span>
          <span>Meeting</span>
        </button>

        <div class="toolbar-divider" id="actionDivider"></div>

        <!-- Google Account Status -->
        <button class="toolbar-icon-btn" id="googleBtn" title="Connect Google (Calendar + Contacts)">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
            <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
            <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
            <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
          </svg>
          <span class="toolbar-status-badge" id="googleStatus"></span>
        </button>

        <!-- Import Button -->
        <button class="toolbar-icon-btn" id="importBtn" title="Import Transcripts">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
          </svg>
        </button>

        <!-- Contacts Button -->
        <button class="toolbar-icon-btn" id="contactsBtn" title="Contacts">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" fill="currentColor"/>
          </svg>
        </button>

        <!-- Settings Button -->
        <button class="toolbar-icon-btn" id="settingsBtn" title="Settings">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22l-1.92 3.32c-.12.21-.07.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" fill="currentColor"/>
          </svg>
        </button>

        <!-- Hidden toggle sidebar button (kept for compatibility) -->
        <button id="toggleSidebar" class="toolbar-icon-btn" style="display: none;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 18H21V16H3V18ZM3 13H21V11H3V13ZM3 6V8H21V6H3Z" fill="currentColor"/>
          </svg>
        </button>
      </header>

      <!-- Home Screen View -->
      <div id="homeView">
        <!-- Bulk Actions Toolbar -->
        <div class="bulk-actions-toolbar" id="bulkActionsToolbar" style="display: none;">
          <div class="bulk-actions-left">
            <span class="bulk-selection-count" id="bulkSelectionCount">0 selected</span>
            <button class="btn btn-text" id="selectAllBtn">Select All</button>
            <button class="btn btn-text" id="deselectAllBtn">Deselect All</button>
          </div>
          <div class="bulk-actions-right">
            <button class="btn btn-danger" id="batchDeleteBtn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 19C6 20.1 6.9 21 8 21H16C17.1 21 18 20.1 18 19V7H6V19ZM19 4H15.5L14.5 3H9.5L8.5 4H5V6H19V4Z" fill="currentColor"/>
              </svg>
              Delete
            </button>
            <button class="btn btn-primary" id="batchExportBtn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M14 2H6C4.9 2 4.01 2.9 4.01 4L4 20C4 21.1 4.89 22 5.99 22H18C19.1 22 20 21.1 20 20V8L14 2ZM18 20H6V4H13V9H18V20Z" fill="currentColor"/>
              </svg>
              Export to Obsidian
            </button>
            <button class="btn btn-secondary" id="cancelBulkSelectionBtn">Cancel</button>
          </div>
        </div>

        <main class="main-content">
          <div class="content-container">
            <!-- Only showing notes section, calendar hidden -->
            <section class="meetings-section">
              <div class="section-header">
                <h2 class="section-title">Notes</h2>
                <div class="section-actions">
                  <button class="btn btn-outline btn-icon-text" id="toggleBulkSelectBtn" title="Select multiple meetings">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM10 17L5 12L6.41 10.59L10 14.17L17.59 6.58L19 8L10 17Z" fill="currentColor"/>
                    </svg>
                    Multi-Select
                  </button>
                </div>
              </div>
              <div class="meetings-list" id="notes-list">
                <!-- Meeting cards will be inserted here by JavaScript -->
              </div>
            </section>
          </div>
        </main>
      </div>

      <!-- Meeting Detail View -->
      <div id="editorView" style="display: none;">
        <div class="meeting-detail-container">
          <!-- Header with Back Button -->
          <div class="meeting-detail-header">
            <h2 class="meeting-detail-page-title">Meeting Details</h2>
          </div>

          <!-- Meeting Info Card -->
          <div class="meeting-info-card" id="meetingInfoCard">
            <!-- View Mode -->
            <div class="meeting-info-view-mode" id="meetingInfoViewMode">
              <div class="meeting-title-row">
                <h1 class="meeting-title" id="meetingDetailTitle">Meeting Title</h1>
                <button class="icon-btn" id="editMeetingInfoBtn" title="Edit meeting info">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" fill="currentColor"/>
                  </svg>
                </button>
              </div>

              <div class="meeting-meta-row">
                <span class="meeting-meta-item">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 4H18V2H16V4H8V2H6V4H5C3.89 4 3.01 4.9 3.01 6L3 20C3 21.1 3.89 22 5 22H19C20.1 22 21 21.1 21 20V6C21 4.9 20.1 4 19 4ZM19 20H5V10H19V20Z" fill="currentColor"/>
                  </svg>
                  <span id="meetingDetailDateTime">Jan 15, 2025 at 3:00 PM</span>
                </span>
                <span class="meeting-meta-item">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" fill="currentColor"/>
                  </svg>
                  <span id="meetingDetailParticipantCount">3 participants</span>
                </span>
                <span class="meeting-meta-item" id="meetingDetailPlatform">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z" fill="currentColor"/>
                  </svg>
                  <span id="meetingDetailPlatformText">Meeting</span>
                </span>
                <span class="meeting-meta-item" id="meetingDetailObsidianStatus">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z" fill="currentColor"/>
                  </svg>
                  <span id="meetingDetailObsidianStatusText">Not synced</span>
                </span>
              </div>

              <div class="meeting-vault-path" id="meetingVaultPathDisplay">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z" fill="currentColor"/>
                </svg>
                <span id="meetingDetailVaultPath">clients/acme-corp/meetings/2025-01-15-kickoff.md</span>
              </div>
            </div>

            <!-- Edit Mode -->
            <div class="meeting-info-edit-mode" id="meetingInfoEditMode" style="display: none;">
              <div class="meeting-info-edit-header">
                <h3>Edit Meeting Info</h3>
                <div class="meeting-info-edit-actions">
                  <button class="btn btn-secondary btn-sm" id="cancelMeetingInfoEditBtn">Cancel</button>
                  <button class="btn btn-primary btn-sm" id="saveMeetingInfoBtn">Save</button>
                </div>
              </div>
              <div class="meeting-info-edit-fields">
                <div class="edit-field">
                  <label for="editMeetingTitle">Title</label>
                  <input type="text" id="editMeetingTitle" placeholder="Meeting title..." />
                </div>
                <div class="edit-field">
                  <label for="editMeetingPlatform">Platform</label>
                  <select id="editMeetingPlatform">
                    <option value="unknown">Unknown / Other</option>
                    <option value="zoom">Zoom</option>
                    <option value="teams">Microsoft Teams</option>
                    <option value="google-meet">Google Meet</option>
                    <option value="in-person">In-Person Meeting</option>
                  </select>
                </div>
                <div class="edit-field">
                  <label for="editMeetingVaultPath">Vault Path</label>
                  <div class="vault-path-edit-row">
                    <input type="text" id="editMeetingVaultPath" placeholder="clients/acme-corp/meetings/..." />
                    <button class="btn btn-danger btn-sm" id="unlinkMeetingBtn" title="Remove Obsidian sync">Unlink</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Participants Card -->
          <div class="meeting-participants-card">
            <div class="card-header">
              <h3 class="card-title">Participants</h3>
            </div>
            <div class="participants-list" id="meetingDetailParticipants">
              <!-- Participants will be dynamically inserted -->
            </div>
          </div>

          <!-- Tabbed Content Area -->
          <div class="meeting-content-tabs">
            <div class="tab-headers">
              <button id="summaryTabBtn" class="tab-header active" data-tab="summary">Exec Summary</button>
              <button id="templatesTabBtn" class="tab-header" data-tab="templates">Detailed Summary</button>
              <button id="transcriptTabBtn" class="tab-header" data-tab="transcript">Transcript</button>
              <button id="metadataTabBtn" class="tab-header" data-tab="metadata">Metadata</button>
            </div>

            <div class="tab-content-container">
              <!-- Summary Tab -->
              <div class="tab-content active" id="summaryTab">
                <div class="summary-actions">
                  <button class="btn btn-outline btn-sm" id="editSummaryBtn" style="display: none;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" fill="currentColor"/>
                    </svg>
                    Edit
                  </button>
                  <button class="btn btn-primary btn-sm" id="saveSummaryBtn" style="display: none;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="currentColor"/>
                    </svg>
                    Save
                  </button>
                  <button class="btn btn-outline btn-sm" id="cancelEditSummaryBtn" style="display: none;">Cancel</button>
                </div>
                <div class="summary-view-mode" id="summaryViewMode">
                  <div class="summary-content" id="meetingDetailSummary">
                    <p class="placeholder-text">No summary generated yet</p>
                  </div>
                </div>
                <div class="summary-edit-mode" id="summaryEditMode" style="display: none;">
                  <textarea class="summary-editor" id="summaryEditor"></textarea>
                </div>
              </div>

              <!-- Detailed Summary Tab (formerly Templates) -->
              <div class="tab-content" id="templatesTab">
                <div class="templates-header">
                  <p class="templates-description">Generate detailed summaries using custom templates. Use the Generate button in the toolbar above.</p>
                </div>
                <div class="generated-templates-list" id="generatedTemplatesList">
                  <!-- Generated template summaries will appear here -->
                </div>
              </div>

              <!-- Transcript Tab -->
              <div class="tab-content" id="transcriptTab">
                <div class="transcript-toolbar">
                  <input type="text" class="transcript-search" id="transcriptSearch" placeholder="Search transcript..." />
                  <button class="icon-btn" id="transcriptSearchBtn" title="Search">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="currentColor"/>
                    </svg>
                  </button>
                  <button class="btn btn-outline btn-sm" id="fixSpeakersBtn" title="Map cryptic speaker IDs to contacts" style="display: none;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" fill="currentColor"/>
                    </svg>
                    Fix Speakers
                  </button>
                </div>
                <div class="transcript-content" id="meetingDetailTranscript">
                  <p class="placeholder-text">No transcript available</p>
                </div>
              </div>

              <!-- Metadata Tab -->
              <div class="tab-content" id="metadataTab">
                <div class="metadata-section">
                  <h4>Meeting Information</h4>
                  <div class="metadata-field">
                    <label>Meeting ID</label>
                    <input type="text" id="metadataMeetingId" readonly />
                  </div>
                  <div class="metadata-field">
                    <label>Recording ID</label>
                    <input type="text" id="metadataRecordingId" readonly />
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="meeting-actions">
            <button class="btn-subtle" id="regenerateSummaryBtn">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" fill="currentColor"/>
              </svg>
              Regenerate Summary
            </button>
          </div>
        </div>

          <aside class="sidebar" id="sidebar" style="display:none;">
            <div class="sidebar-content">
              <section class="sidebar-section">
                <h3>SHARE NOTES</h3>
                <div class="share-options">
                  <button class="share-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M3.9 12C3.9 10.29 5.29 8.9 7 8.9H11V7H7C4.24 7 2 9.24 2 12C2 14.76 4.24 17 7 17H11V15.1H7C5.29 15.1 3.9 13.71 3.9 12ZM8 13H16V11H8V13ZM17 7H13V8.9H17C18.71 8.9 20.1 10.29 20.1 12C20.1 13.71 18.71 15.1 17 15.1H13V17H17C19.76 17 22 14.76 22 12C22 9.24 19.76 7 17 7Z" fill="#666666"/>
                    </svg>
                    Copy link
                  </button>
                  <button class="share-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM19 19H5V5H19V19ZM7 10H9V17H7V10ZM11 7H13V17H11V7ZM15 13H17V17H15V13Z" fill="#666666"/>
                    </svg>
                    Copy text
                  </button>
                </div>

                <div class="share-export">
                  <button class="share-btn wide">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M20 4H4C2.9 4 2.01 4.9 2.01 6L2 18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4ZM20 18H4V8L12 13L20 8V18ZM12 11L4 6H20L12 11Z" fill="#666666"/>
                    </svg>
                    Email
                  </button>
                  <button class="share-btn wide">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M22 6C22 4.9 21.1 4 20 4H4C2.9 4 2 4.9 2 6V18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6ZM20 6L12 11L4 6H20ZM20 18H4V8L12 13L20 8V18Z" fill="#4285F4"/>
                    </svg>
                    Slack
                  </button>
                </div>
              </section>

              <section class="sidebar-section">
                <h3>AI ASSISTANT</h3>
                <div class="ai-options">
                  <button class="ai-btn">Generate meeting summary</button>
                  <button class="ai-btn">List action items</button>
                  <button class="ai-btn">Write follow-up email</button>
                  <button class="ai-btn">List Q&A</button>
                </div>
              </section>
            </div>
          </aside>
        </div>

        <div class="floating-controls">
          <div class="upload-progress" id="uploadProgress" style="display: none;">
            <div class="upload-progress-bar">
              <div class="upload-progress-fill" id="uploadProgressFill"></div>
            </div>
            <div class="upload-progress-text" id="uploadProgressText">Uploading 0%</div>
          </div>
          <div class="control-buttons">
            <button class="control-btn record-btn" id="recordButton">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="record-icon">
                <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z" fill="currentColor"/>
                <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" fill="currentColor"/>
              </svg>
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="stop-icon" style="display: none;">
                <path d="M6 6h12v12H6V6z" fill="currentColor"/>
              </svg>
            </button>
            <button class="control-btn generate-btn" id="generateButton">
              <svg width="16" height="16" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 4px;">
                <path d="M208,512a24.84,24.84,0,0,1-23.34-16l-39.84-103.6a16.06,16.06,0,0,0-9.19-9.19L32,343.34a25,25,0,0,1,0-46.68l103.6-39.84a16.06,16.06,0,0,0,9.19-9.19L184.66,144a25,25,0,0,1,46.68,0l39.84,103.6a16.06,16.06,0,0,0,9.19,9.19l103,39.63A25.49,25.49,0,0,1,400,320.52a24.82,24.82,0,0,1-16,22.82l-103.6,39.84a16.06,16.06,0,0,0-9.19,9.19L231.34,496A24.84,24.84,0,0,1,208,512Z" fill="currentColor"/>
                <path d="M88,176a14.67,14.67,0,0,1-13.69-9.4L57.45,122.76a7.28,7.28,0,0,0-4.21-4.21L9.4,101.69a14.67,14.67,0,0,1,0-27.38L53.24,57.45a7.31,7.31,0,0,0,4.21-4.21L74.16,9.79A15,15,0,0,1,86.23.11,14.67,14.67,0,0,1,101.69,9.4l16.86,43.84a7.31,7.31,0,0,0,4.21,4.21L166.6,74.31a14.67,14.67,0,0,1,0,27.38l-43.84,16.86a7.28,7.28,0,0,0-4.21,4.21L101.69,166.6A14.67,14.67,0,0,1,88,176Z" fill="currentColor"/>
                <path d="M400,256a16,16,0,0,1-14.93-10.26l-22.84-59.37a8,8,0,0,0-4.6-4.6l-59.37-22.84a16,16,0,0,1,0-29.86l59.37-22.84a8,8,0,0,0,4.6-4.6L384.9,42.68a16.45,16.45,0,0,1,13.17-10.57,16,16,0,0,1,16.86,10.15l22.84,59.37a8,8,0,0,0,4.6,4.6l59.37,22.84a16,16,0,0,1,0,29.86l-59.37,22.84a8,8,0,0,0-4.6,4.6l-22.84,59.37A16,16,0,0,1,400,256Z" fill="currentColor"/>
              </svg>
              Generate
            </button>
            <button class="control-btn obsidian-btn" id="exportToObsidianBtn" style="display: none;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 4px;">
                <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="currentColor"/>
                <path d="M2 17L12 22L22 17M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Export to Obsidian
            </button>
            <button class="control-btn obsidian-btn" id="obsidianButton" style="display: none;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 4px;">
                <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="currentColor"/>
                <path d="M2 17L12 22L22 17M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span id="obsidianButtonText">Publish to Obsidian</span>
            </button>
          </div>
        </div>

        <div class="chat-input-container">
          <div class="chat-input">
            <input type="text" id="chatInput" placeholder="Ask about the meeting..." style="display: none;" />
            <button id="sendButton" style="display: none;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M2.01 21L23 12L2.01 3L2 10L17 12L2 14L2.01 21Z" fill="#0077FF"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Re-record Confirmation Modal -->
    <div class="modal-overlay" id="reRecordModal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Existing Transcript Found</h2>
          <button class="modal-close" id="closeReRecordModal">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="currentColor"/>
            </svg>
          </button>
        </div>

        <div class="modal-body">
          <p style="margin-bottom: 20px;">This meeting already has a transcript. What would you like to do?</p>

          <div class="re-record-options">
            <button class="re-record-option" data-action="append">
              <div class="option-icon">üìé</div>
              <div class="option-content">
                <div class="option-title">Append New Recording</div>
                <div class="option-description">Add the new recording to the end of the existing transcript</div>
              </div>
            </button>

            <button class="re-record-option" data-action="overwrite">
              <div class="option-icon">‚ö†Ô∏è</div>
              <div class="option-content">
                <div class="option-title">Overwrite Existing Transcript</div>
                <div class="option-description">Replace the current transcript with the new recording (cannot be undone)</div>
              </div>
            </button>

            <button class="re-record-option" data-action="cancel">
              <div class="option-icon">‚ùå</div>
              <div class="option-content">
                <div class="option-title">Cancel</div>
                <div class="option-description">Keep the existing transcript and don't record</div>
              </div>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Save View Modal -->
    <div class="modal-overlay" id="saveViewModal" style="display: none;">
      <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header">
          <h2>Save View</h2>
          <button class="modal-close" id="closeSaveViewModal">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="currentColor"/>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <p style="margin-bottom: 15px;">Enter a name for this view:</p>
          <input type="text" id="saveViewNameInput" class="modal-input" placeholder="e.g., Client Meetings" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 14px; background: var(--bg-primary); color: var(--text-primary);">
        </div>
        <div class="modal-footer" style="display: flex; gap: 10px; justify-content: flex-end; padding-top: 15px;">
          <button class="btn-secondary" id="cancelSaveViewBtn" style="padding: 8px 16px; border-radius: 6px; cursor: pointer;">Cancel</button>
          <button class="btn-primary" id="confirmSaveViewBtn" style="padding: 8px 16px; border-radius: 6px; cursor: pointer;">Save</button>
        </div>
      </div>
    </div>

    <!-- v1.2: Edit View Modal -->
    <div class="modal-overlay" id="editViewModal" style="display: none;">
      <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header">
          <h2>Edit View</h2>
          <button class="modal-close" id="closeEditViewModal">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="currentColor"/>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <p style="margin-bottom: 15px;">Edit the view name:</p>
          <input type="text" id="editViewNameInput" class="modal-input" placeholder="View name" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 14px; background: var(--bg-primary); color: var(--text-primary);">
          <input type="hidden" id="editViewId">
        </div>
        <div class="modal-footer" style="display: flex; gap: 10px; justify-content: flex-end; padding-top: 15px;">
          <button class="btn-danger" id="deleteViewFromEditBtn" style="padding: 8px 16px; border-radius: 6px; cursor: pointer; margin-right: auto;">Delete</button>
          <button class="btn-secondary" id="cancelEditViewBtn" style="padding: 8px 16px; border-radius: 6px; cursor: pointer;">Cancel</button>
          <button class="btn-primary" id="confirmEditViewBtn" style="padding: 8px 16px; border-radius: 6px; cursor: pointer;">Save</button>
        </div>
      </div>
    </div>

    <!-- v1.2: Manage Views Modal -->
    <div class="modal-overlay" id="manageViewsModal" style="display: none;">
      <div class="modal-content" style="max-width: 450px;">
        <div class="modal-header">
          <h2>Manage Views</h2>
          <button class="modal-close" id="closeManageViewsModal">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="currentColor"/>
            </svg>
          </button>
        </div>
        <div class="modal-body" style="max-height: 400px; overflow-y: auto;">
          <div id="manageViewsList"></div>
        </div>
        <div class="modal-footer" style="display: flex; gap: 10px; justify-content: flex-end; padding-top: 15px;">
          <button class="btn-primary" id="closeManageViewsBtn" style="padding: 8px 16px; border-radius: 6px; cursor: pointer;">Done</button>
        </div>
      </div>
    </div>

    <!-- Template Selection Modal -->
    <div class="modal-overlay" id="templateModal" style="display: none;">
      <div class="modal-content template-modal">
        <div class="modal-header">
          <h2>Select Summary Templates</h2>
          <button class="modal-close" id="closeTemplateModal">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="currentColor"/>
            </svg>
          </button>
        </div>

        <div class="modal-body">
          <p class="template-description">Choose one or more templates to generate summaries:</p>

          <div class="template-list" id="templateList">
            <!-- Templates will be loaded here dynamically -->
          </div>

          <!-- Generation Options -->
          <div class="generation-options" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-color);">
            <div class="generation-option-group" style="margin-bottom: 16px;">
              <label style="font-weight: 600; margin-bottom: 8px; display: block; font-size: 13px;">Summary Mode</label>
              <div class="segmented-control" id="generateModeControl">
                <button type="button" class="segment active" data-value="replace">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 6px;">
                    <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
                  </svg>
                  Replace
                </button>
                <button type="button" class="segment" data-value="append">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 6px;">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                  </svg>
                  Append
                </button>
              </div>
              <input type="hidden" name="generateMode" id="generateModeInput" value="replace">
              <small style="color: var(--text-secondary); font-size: 11px; margin-top: 6px; display: block;" id="generateModeDescription">Overwrite existing summaries with new ones</small>
            </div>
            <div class="generation-option-group">
              <label for="generateModelSelect" style="font-weight: 600; margin-bottom: 8px; display: block; font-size: 13px;">AI Model</label>
              <select id="generateModelSelect" style="width: 100%; padding: 8px 12px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary); font-size: 13px;">
                <option value="default">Default (from settings)</option>
                <optgroup label="üí∞ Budget">
                  <option value="openai-gpt-5-nano">GPT-5 nano ‚Äî $0.05/$0.40 per 1M tokens</option>
                  <option value="openai-gpt-4.1-nano">GPT-4.1 nano ‚Äî $0.10/$0.40 per 1M tokens</option>
                </optgroup>
                <optgroup label="‚öñÔ∏è Balanced">
                  <option value="openai-gpt-4o-mini">GPT-4o mini ‚Äî $0.15/$0.60 per 1M tokens</option>
                  <option value="openai-gpt-5-mini">GPT-5 mini ‚Äî $0.25/$2.00 per 1M tokens</option>
                  <option value="openai-gpt-4.1-mini">GPT-4.1 mini ‚Äî $0.40/$1.60 per 1M tokens</option>
                </optgroup>
                <optgroup label="‚≠ê Premium">
                  <option value="claude-haiku-4-5">Claude Haiku 4.5 ‚Äî $1.00/$5.00 per 1M tokens</option>
                </optgroup>
                <optgroup label="üíé Ultra-premium">
                  <option value="claude-sonnet-4">Claude Sonnet 4 ‚Äî $3.00/$15.00 per 1M tokens</option>
                  <option value="claude-sonnet-4-5">Claude Sonnet 4.5 ‚Äî $3.00/$15.00 per 1M tokens</option>
                </optgroup>
              </select>
              <small style="color: var(--text-secondary); font-size: 11px; margin-top: 4px; display: block;">Select a model for this generation only (won't change your default)</small>
            </div>
          </div>

          <!-- CS-4: Routing Preview -->
          <div class="routing-preview" id="routingPreview">
            <div class="routing-preview-header">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71L12 2zm0 11.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" fill="currentColor"/>
              </svg>
              <span>Save Location</span>
              <button class="routing-change-btn" id="routingChangeBtn" type="button" title="Change destination">Change</button>
            </div>
            <div class="routing-preview-content" id="routingPreviewContent">
              <div class="routing-preview-loading">Loading...</div>
            </div>
            <!-- CS-4.4: Destination picker (hidden by default) -->
            <div class="routing-destination-picker" id="routingDestinationPicker" style="display: none;">
              <select id="routingDestinationSelect" class="routing-destination-select">
                <option value="">Loading destinations...</option>
              </select>
              <div class="routing-destination-actions">
                <button type="button" class="routing-destination-apply" id="routingDestinationApply">Apply</button>
                <button type="button" class="routing-destination-cancel" id="routingDestinationCancel">Cancel</button>
              </div>
            </div>
            <!-- CS-4.6: New organization form (hidden by default) -->
            <div class="routing-new-org-form" id="routingNewOrgForm" style="display: none;">
              <div class="routing-new-org-header">
                <span>Create New Organization</span>
                <button type="button" class="routing-new-org-close" id="routingNewOrgClose">&times;</button>
              </div>
              <div class="routing-new-org-fields">
                <div class="routing-new-org-field">
                  <label for="routingNewOrgType">Type</label>
                  <select id="routingNewOrgType" class="routing-new-org-select">
                    <option value="client">Client</option>
                    <option value="industry">Industry</option>
                  </select>
                </div>
                <div class="routing-new-org-field">
                  <label for="routingNewOrgName">Name</label>
                  <input type="text" id="routingNewOrgName" class="routing-new-org-input" placeholder="e.g., Acme Corporation">
                </div>
                <div class="routing-new-org-field">
                  <label for="routingNewOrgSlug">Folder Name (slug)</label>
                  <input type="text" id="routingNewOrgSlug" class="routing-new-org-input" placeholder="e.g., acme-corp">
                </div>
                <div class="routing-new-org-field">
                  <label>Email Domains</label>
                  <div class="routing-new-org-domains" id="routingNewOrgDomains">
                    <!-- Domain chips populated dynamically -->
                  </div>
                </div>
              </div>
              <div class="routing-new-org-actions">
                <button type="button" class="routing-new-org-create" id="routingNewOrgCreate">Create & Select</button>
                <button type="button" class="routing-new-org-cancel" id="routingNewOrgCancel">Cancel</button>
              </div>
            </div>
            <!-- CS-4.5: Create routing rule prompt (hidden by default) -->
            <div class="routing-create-rule" id="routingCreateRule" style="display: none;">
              <div class="routing-create-rule-prompt">
                <span class="routing-create-rule-icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                  </svg>
                </span>
                <span class="routing-create-rule-text">
                  Create a routing rule so future meetings with these participants go here automatically?
                </span>
              </div>
              <div class="routing-create-rule-domains" id="routingCreateRuleDomains">
                <!-- Domains will be populated dynamically -->
              </div>
              <div class="routing-create-rule-actions">
                <button type="button" class="routing-create-rule-btn" id="routingCreateRuleBtn">Create Rule</button>
                <button type="button" class="routing-create-rule-dismiss" id="routingCreateRuleDismiss">Dismiss</button>
              </div>
            </div>
          </div>

          <div class="cost-estimate" id="costEstimate" style="display: none;">
            <div class="cost-header">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z" fill="currentColor"/>
              </svg>
              <span>Estimated Cost</span>
            </div>
            <div class="cost-details">
              <div class="cost-item">
                <span>Tokens:</span>
                <span id="totalTokens">-</span>
              </div>
              <div class="cost-item">
                <span>Cost:</span>
                <span id="totalCost" class="cost-amount">$0.00</span>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" id="cancelGenerate">Cancel</button>
          <button class="btn btn-primary" id="confirmGenerate" disabled>Generate Summaries</button>
        </div>
      </div>
    </div>

    <!-- Import Transcripts Modal -->
    <div class="modal-overlay" id="importModal" style="display: none;">
      <div class="modal-content import-modal">
        <div class="modal-header">
          <h2>Import Transcripts</h2>
          <button class="modal-close" id="closeImportModal">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="currentColor"/>
            </svg>
          </button>
        </div>

        <div class="modal-body">
          <p class="import-description">Import meeting transcripts or audio files for transcription.</p>

          <!-- File Selection Area -->
          <div class="file-drop-zone" id="fileDropZone">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" fill="#999"/>
            </svg>
            <h3>Drop files here or</h3>
            <div style="display: flex; gap: 12px; justify-content: center; margin-top: 12px;">
              <button class="btn btn-secondary" id="browseFilesBtn">Browse Files</button>
              <button class="btn btn-secondary" id="browseFolderBtn">Browse Folder</button>
            </div>
            <p style="margin-top: 12px;">Transcripts: .txt, .md, .vtt, .srt &nbsp;|&nbsp; Audio: .mp3, .wav, .m4a</p>
            <input type="file" id="fileInput" multiple accept=".txt,.md,.vtt,.srt,.mp3,.wav,.m4a,.ogg,.webm,.flac,.aac" style="display: none;" />
            <input type="file" id="folderInput" webkitdirectory directory style="display: none;" />
          </div>

          <!-- Selected Files List -->
          <div class="selected-files" id="selectedFilesList" style="display: none;">
            <div class="selected-files-header">
              <h3>Selected Files (<span id="fileCount">0</span>)</h3>
              <button class="btn btn-secondary btn-sm" id="clearFilesBtn">Clear All</button>
            </div>
            <div class="files-list" id="filesListContainer">
              <!-- File items will be added here dynamically -->
            </div>
          </div>

          <!-- Import Options -->
          <div class="import-options" id="importOptions" style="display: none;">
            <h3>Import Options</h3>

            <div class="import-option-group">
              <h4 style="margin: 0 0 8px 0; font-size: 14px; color: var(--text-secondary);">Summaries</h4>
              <label class="checkbox-label">
                <input type="checkbox" id="generateAutoSummaryCheck" checked />
                <span>Generate auto-summary</span>
              </label>

              <!-- Line break -->
              <div style="height: 12px;"></div>

              <div id="templateCheckboxes">
                <!-- Template checkboxes will be dynamically added here -->
              </div>
            </div>

            <!-- Line break -->
            <div style="height: 16px;"></div>

            <div class="import-option-group">
              <h4 style="margin: 0 0 8px 0; font-size: 14px; color: var(--text-secondary);">Export</h4>
              <label class="checkbox-label">
                <input type="checkbox" id="autoExportCheck" />
                <span>Auto-export to Obsidian vault</span>
              </label>
            </div>

            <!-- Line break -->
            <div style="height: 16px;"></div>

            <!-- IM-1.3: Audio Transcription Provider (shown when audio files selected) -->
            <div class="import-option-group" id="audioProviderGroup" style="display: none;">
              <h4 style="margin: 0 0 8px 0; font-size: 14px; color: var(--text-secondary);">Audio Transcription</h4>
              <p style="margin: 0 0 8px 0; font-size: 12px; color: #888;">
                <span id="audioFileCount">0</span> audio file(s) will be transcribed before import
              </p>
              <label style="display: flex; align-items: center; gap: 8px;">
                <span style="font-size: 13px;">Provider:</span>
                <select id="audioProviderSelect" class="import-provider-select" style="padding: 6px 10px; border-radius: 4px; border: 1px solid #ddd; font-size: 13px;">
                  <option value="assemblyai">AssemblyAI ($0.37/hr)</option>
                  <option value="deepgram">Deepgram ($0.43/hr)</option>
                </select>
              </label>
              <p style="margin: 8px 0 0 0; font-size: 11px; color: #999;">
                Note: Audio transcription may take several minutes per file
              </p>
            </div>

            <!-- Line break for audio provider -->
            <div id="audioProviderSpacer" style="height: 16px; display: none;"></div>

            <!-- UI-1.6: Meeting Platform Selection -->
            <div class="import-option-group">
              <h4 style="margin: 0 0 8px 0; font-size: 14px; color: var(--text-secondary);">Meeting Platform</h4>
              <p style="margin: 0 0 8px 0; font-size: 12px; color: #888;">
                Select the original meeting platform (for imported files)
              </p>
              <label style="display: flex; align-items: center; gap: 8px;">
                <span style="font-size: 13px;">Platform:</span>
                <select id="importPlatformSelect" class="import-provider-select" style="padding: 6px 10px; border-radius: 4px; border: 1px solid #ddd; font-size: 13px;">
                  <option value="unknown">Unknown / Other</option>
                  <option value="zoom">Zoom</option>
                  <option value="teams">Microsoft Teams</option>
                  <option value="google-meet">Google Meet</option>
                  <option value="in-person">In-Person Meeting</option>
                </select>
              </label>
            </div>

            <!-- Line break for platform -->
            <div style="height: 16px;"></div>

            <div class="import-option-group">
              <h4 style="margin: 0 0 8px 0; font-size: 14px; color: var(--text-secondary);">Pattern Testing</h4>
              <label class="checkbox-label">
                <input type="checkbox" id="previewParsingCheck" />
                <span>Preview parsing before importing (shows first file)</span>
              </label>
            </div>
          </div>

          <!-- Progress Indicator -->
          <div class="import-progress" id="importProgress" style="display: none;">
            <div class="progress-header">
              <span>Importing...</span>
              <span id="progressText">0 / 0</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" id="importProgressFill"></div>
            </div>
            <div id="currentFileStatus"></div>
          </div>
        </div>

        <div class="modal-footer">
          <div style="flex: 1; font-size: 12px; color: var(--text-secondary); text-align: left;">
            Import runs in background - you can close this window after starting
          </div>
          <button class="btn btn-secondary" id="cancelImport">Cancel</button>
          <button class="btn btn-primary" id="startImport" disabled>Import Files</button>
        </div>
      </div>
    </div>

    <!-- Pattern Preview Modal (Phase 10.8.2) -->
    <div class="modal-overlay" id="patternPreviewModal" style="display: none;">
      <div class="modal-content pattern-preview-modal">
        <div class="modal-header">
          <h2>Import Preview</h2>
          <button class="modal-close" id="closePatternPreviewModal">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="currentColor"/>
            </svg>
          </button>
        </div>

        <div class="modal-body">
          <div id="patternPreviewFileInfo"></div>

          <!-- Statistics -->
          <div class="pattern-section">
            <h3>Parsing Statistics</h3>
            <div id="patternPreviewStats"></div>
          </div>

          <!-- Warnings -->
          <div id="patternPreviewWarnings" style="display: none;"></div>

          <!-- Speaker Distribution -->
          <div class="pattern-section">
            <h3>Speaker Distribution</h3>
            <div id="patternPreviewSpeakerDist"></div>
          </div>

          <!-- Sample Entries -->
          <div class="pattern-section">
            <h3>Sample Entries (First 10)</h3>
            <div id="patternPreviewSampleEntries"></div>
          </div>

          <!-- Error Display -->
          <div id="patternPreviewError" class="pattern-error" style="display: none;"></div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" id="patternPreviewCancelBtn">Cancel Import</button>
          <button class="btn btn-primary" id="patternPreviewConfirmBtn">Confirm & Import</button>
        </div>
      </div>
    </div>

    <!-- AI Pattern Generation Modal removed (Phase 10.8.3 removed) -->

    <!-- Speaker Mapping Modal (SM-2) -->
    <div class="modal-overlay" id="speakerMappingModal" style="display: none;">
      <div class="modal-content speaker-mapping-modal">
        <div class="modal-header">
          <h2>Map Speakers to Contacts</h2>
          <button class="modal-close" id="closeSpeakerMappingModal">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="currentColor"/>
            </svg>
          </button>
        </div>

        <div class="modal-body">
          <p class="speaker-mapping-description">
            Map speakers to contacts. Mapped speakers will be saved for future imports.
          </p>

          <!-- Speaker Mappings List -->
          <div class="speaker-mappings-list" id="speakerMappingsList">
            <!-- Dynamically populated speaker mapping rows -->
          </div>

          <!-- No Speakers Message -->
          <div id="noSpeakersMessage" class="no-speakers-message" style="display: none;">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="#4caf50"/>
            </svg>
            <p>No speakers found in this transcript.</p>
          </div>
        </div>

        <div class="modal-footer">
          <div class="speaker-mapping-stats">
            <span id="speakerMappingStatsText">0 speakers mapped</span>
          </div>
          <div class="speaker-mapping-actions">
            <button class="btn btn-outline" id="mergeSpeakersBtn" title="Select multiple speakers to merge">Merge Speakers</button>
            <button class="btn btn-warning" id="confirmMergeBtn" style="display: none;" disabled>Select 2+ Speakers</button>
          </div>
          <button class="btn btn-secondary" id="cancelSpeakerMapping">Cancel</button>
          <button class="btn btn-primary" id="applySpeakerMappings" disabled>Apply Mappings</button>
        </div>
      </div>
    </div>

    </div><!-- end mainView -->

    <!-- Settings Full-Page View (Phase 10.2) -->
    <div id="settingsView" class="settings-full-page" style="display: none;">
        <div class="modal-header">
          <h2>Settings</h2>
          <button class="modal-close" id="closeSettings">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="currentColor"/>
            </svg>
          </button>
        </div>

        <div class="settings-content">
          <!-- Settings Sidebar -->
          <div class="settings-sidebar">
            <div id="profileSettingsTab" class="settings-tab" data-tab="profile">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" fill="currentColor"/>
              </svg>
              <span>My Profile</span>
            </div>
            <div id="generalSettingsTab" class="settings-tab active" data-tab="general">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" fill="currentColor"/>
              </svg>
              <span>General</span>
            </div>
            <div id="securitySettingsTab" class="settings-tab" data-tab="security">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z" fill="currentColor"/>
              </svg>
              <span>Security</span>
            </div>
            <div id="routingSettingsTab" class="settings-tab" data-tab="routing">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71L12 2zm0 11.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" fill="currentColor"/>
              </svg>
              <span>Routing</span>
            </div>
            <div id="templatesSettingsTab" class="settings-tab" data-tab="templates">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" fill="currentColor"/>
              </svg>
              <span>Templates</span>
            </div>
            <div id="vocabularySettingsTab" class="settings-tab" data-tab="vocabulary">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z" fill="currentColor"/>
              </svg>
              <span>Vocabulary</span>
            </div>
            <div id="patternsSettingsTab" class="settings-tab" data-tab="patterns">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z" fill="currentColor"/>
              </svg>
              <span>Transcript Patterns</span>
            </div>
            <div id="notificationsSettingsTab" class="settings-tab" data-tab="notifications">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z" fill="currentColor"/>
              </svg>
              <span>Notifications</span>
            </div>
            <div id="shortcutsSettingsTab" class="settings-tab" data-tab="shortcuts">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zM9 14H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2zm-8 4H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2z" fill="currentColor"/>
              </svg>
              <span>Keyboard Shortcuts</span>
            </div>
            <!-- v1.2: Stream Deck Integration -->
            <div id="streamDeckSettingsTab" class="settings-tab" data-tab="streamdeck">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M4 6h4v4H4zm0 8h4v4H4zm6-8h4v4h-4zm0 8h4v4h-4zm6-8h4v4h-4zm0 8h4v4h-4z" fill="currentColor"/>
              </svg>
              <span>Stream Deck</span>
            </div>
            <div id="logsSettingsTab" class="settings-tab" data-tab="logs">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z" fill="currentColor"/>
              </svg>
              <span>Logs & Diagnostics</span>
            </div>
            <div id="advancedSettingsTab" class="settings-tab" data-tab="advanced">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z" fill="currentColor"/>
              </svg>
              <span>Advanced</span>
            </div>
            <div id="aboutSettingsTab" class="settings-tab" data-tab="about">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z" fill="currentColor"/>
              </svg>
              <span>About</span>
            </div>
          </div>

          <!-- Settings Panels -->
          <div class="settings-panel" id="profilePanel" style="display: none;">
            <div class="settings-section">
              <h3 class="settings-section-title">Identity</h3>
              <p class="settings-section-description">Your identity is used to match you as a speaker in transcripts and personalize meeting summaries.</p>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Full Name</div>
                  <div class="settings-item-description">Used to identify you in transcripts (e.g., when there's a single speaker)</div>
                </div>
                <div class="settings-item-control">
                  <input type="text" class="settings-input" id="profileName" placeholder="John Smith" />
                </div>
              </div>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Email</div>
                  <div class="settings-item-description">Used to match you in calendar participants</div>
                </div>
                <div class="settings-item-control">
                  <input type="email" class="settings-input" id="profileEmail" placeholder="john@example.com" />
                </div>
              </div>
            </div>

            <div class="settings-section">
              <h3 class="settings-section-title">Professional Context</h3>
              <p class="settings-section-description">This information helps the AI create more relevant and personalized meeting summaries.</p>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Job Title / Role</div>
                  <div class="settings-item-description">Your position or role</div>
                </div>
                <div class="settings-item-control">
                  <input type="text" class="settings-input" id="profileTitle" placeholder="Financial Advisor" />
                </div>
              </div>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Organization</div>
                  <div class="settings-item-description">Your company or organization</div>
                </div>
                <div class="settings-item-control">
                  <input type="text" class="settings-input" id="profileOrganization" placeholder="Acme Financial Services" />
                </div>
              </div>
            </div>

            <div class="settings-section">
              <h3 class="settings-section-title">AI Summary Context</h3>
              <p class="settings-section-description">Custom context provided to the AI when generating meeting summaries. Include your focus areas, communication preferences, or any relevant background.</p>

              <div class="settings-item" style="flex-direction: column; align-items: stretch;">
                <div class="settings-item-info" style="margin-bottom: 12px;">
                  <div class="settings-item-label">Personal Context for Summaries</div>
                  <div class="settings-item-description">This text is included in every summary prompt to personalize the output</div>
                </div>
                <div class="settings-item-control" style="width: 100%;">
                  <textarea class="settings-textarea" id="profileContext" rows="6" placeholder="Example: I'm a financial advisor specializing in retirement planning for high-net-worth clients. I prefer bullet points over paragraphs. Focus on action items, client concerns, and follow-up tasks. Flag any compliance or regulatory topics mentioned."></textarea>
                </div>
              </div>
            </div>

            <div class="settings-section">
              <div class="settings-actions">
                <button class="btn btn-primary" id="saveProfileBtn">Save Profile</button>
                <span class="settings-save-status" id="profileSaveStatus"></span>
              </div>
            </div>
          </div>

          <div class="settings-panel" id="generalPanel">
            <div class="settings-section">
              <h3 class="settings-section-title">Application</h3>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Vault Path</div>
                  <div class="settings-item-description">Location of your Obsidian vault</div>
                </div>
                <div class="settings-item-control" style="display: flex; gap: 8px; align-items: center;">
                  <input type="text" class="settings-input" id="vaultPathInput" placeholder="C:\Users\...\vault" readonly style="flex: 1;" />
                  <button class="btn btn-secondary" id="browseVaultPathBtn">Browse</button>
                </div>
              </div>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Auto-start Recording</div>
                  <div class="settings-item-description">Automatically start recording when calendar meetings begin</div>
                </div>
                <div class="settings-item-control">
                  <div class="toggle-switch" id="autoStartToggle">
                    <div class="toggle-switch-thumb"></div>
                  </div>
                </div>
              </div>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Dark Mode</div>
                  <div class="settings-item-description">Use dark theme for the application interface</div>
                </div>
                <div class="settings-item-control">
                  <div class="toggle-switch" id="darkModeToggle">
                    <div class="toggle-switch-thumb"></div>
                  </div>
                </div>
              </div>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Auto Pop-up Recording Widget</div>
                  <div class="settings-item-description">Automatically show the floating widget when meetings are detected or calendar events start</div>
                </div>
                <div class="settings-item-control">
                  <div class="toggle-switch" id="showRecordingWidgetToggle">
                    <div class="toggle-switch-thumb"></div>
                  </div>
                </div>
              </div>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Minimize to Tray</div>
                  <div class="settings-item-description">Hide window to system tray instead of closing</div>
                </div>
                <div class="settings-item-control">
                  <div class="toggle-switch" id="minimizeToTrayToggle">
                    <div class="toggle-switch-thumb"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- AI Model Configuration Section -->
            <div class="settings-section">
              <h3 class="settings-section-title">AI Model Configuration</h3>
              <div class="settings-item-description" style="margin-bottom: 16px;">
                Choose which AI provider to use for different summary types. Auto-summaries are generated immediately after recording ends, while template summaries are more detailed and customizable.
              </div>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Auto Summary Provider</div>
                  <div class="settings-item-description">AI model for quick summaries after recording (faster, cheaper)</div>
                </div>
                <div class="settings-item-control">
                  <select class="settings-select" id="autoSummaryProviderSelect">
                    <optgroup label="üí∞ Budget Tier">
                      <option value="openai-gpt-5-nano">GPT-5 nano ‚Äî $0.05/$0.40 per MTok</option>
                      <option value="openai-gpt-4.1-nano">GPT-4.1 nano ‚Äî $0.10/$0.40 per MTok</option>
                    </optgroup>
                    <optgroup label="‚öñÔ∏è Balanced Tier">
                      <option value="openai-gpt-4o-mini">GPT-4o mini ‚Äî $0.15/$0.60 per MTok</option>
                      <option value="openai-gpt-5-mini">GPT-5 mini ‚Äî $0.25/$2.00 per MTok</option>
                      <option value="openai-gpt-4.1-mini">GPT-4.1 mini ‚Äî $0.40/$1.60 per MTok</option>
                    </optgroup>
                    <optgroup label="‚≠ê Premium Tier">
                      <option value="claude-haiku-4-5">Claude Haiku 4.5 ‚Äî $1.00/$5.00 per MTok</option>
                    </optgroup>
                    <optgroup label="üíé Ultra-Premium Tier">
                      <option value="claude-sonnet-4">Claude Sonnet 4 ‚Äî $3.00/$15.00 per MTok</option>
                      <option value="claude-sonnet-4-5">Claude Sonnet 4.5 ‚Äî $3.00/$15.00 per MTok</option>
                    </optgroup>
                  </select>
                </div>
              </div>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Template Summary Provider</div>
                  <div class="settings-item-description">AI model for detailed template-based summaries (higher quality)</div>
                </div>
                <div class="settings-item-control">
                  <select class="settings-select" id="templateSummaryProviderSelect">
                    <optgroup label="üí∞ Budget Tier">
                      <option value="openai-gpt-5-nano">GPT-5 nano ‚Äî $0.05/$0.40 per MTok</option>
                      <option value="openai-gpt-4.1-nano">GPT-4.1 nano ‚Äî $0.10/$0.40 per MTok</option>
                    </optgroup>
                    <optgroup label="‚öñÔ∏è Balanced Tier">
                      <option value="openai-gpt-4o-mini">GPT-4o mini ‚Äî $0.15/$0.60 per MTok</option>
                      <option value="openai-gpt-5-mini">GPT-5 mini ‚Äî $0.25/$2.00 per MTok</option>
                      <option value="openai-gpt-4.1-mini">GPT-4.1 mini ‚Äî $0.40/$1.60 per MTok</option>
                    </optgroup>
                    <optgroup label="‚≠ê Premium Tier">
                      <option value="claude-haiku-4-5">Claude Haiku 4.5 ‚Äî $1.00/$5.00 per MTok</option>
                    </optgroup>
                    <optgroup label="üíé Ultra-Premium Tier">
                      <option value="claude-sonnet-4">Claude Sonnet 4 ‚Äî $3.00/$15.00 per MTok</option>
                      <option value="claude-sonnet-4-5">Claude Sonnet 4.5 ‚Äî $3.00/$15.00 per MTok</option>
                    </optgroup>
                  </select>
                </div>
              </div>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Pattern Generation Provider</div>
                  <div class="settings-item-description">AI model for generating transcript patterns (lightweight task)</div>
                </div>
                <div class="settings-item-control">
                  <select class="settings-select" id="patternGenerationProviderSelect">
                    <optgroup label="üí∞ Budget Tier (Recommended)">
                      <option value="openai-gpt-5-nano">GPT-5 nano ‚Äî $0.05/$0.40 per MTok</option>
                      <option value="openai-gpt-4.1-nano">GPT-4.1 nano ‚Äî $0.10/$0.40 per MTok</option>
                    </optgroup>
                    <optgroup label="‚öñÔ∏è Balanced Tier">
                      <option value="openai-gpt-4o-mini">GPT-4o mini ‚Äî $0.15/$0.60 per MTok</option>
                      <option value="openai-gpt-5-mini">GPT-5 mini ‚Äî $0.25/$2.00 per MTok</option>
                      <option value="openai-gpt-4.1-mini">GPT-4.1 mini ‚Äî $0.40/$1.60 per MTok</option>
                    </optgroup>
                    <optgroup label="‚≠ê Premium Tier">
                      <option value="claude-haiku-4-5">Claude Haiku 4.5 ‚Äî $1.00/$5.00 per MTok</option>
                    </optgroup>
                    <optgroup label="üíé Ultra-Premium Tier">
                      <option value="claude-sonnet-4">Claude Sonnet 4 ‚Äî $3.00/$15.00 per MTok</option>
                      <option value="claude-sonnet-4-5">Claude Sonnet 4.5 ‚Äî $3.00/$15.00 per MTok</option>
                    </optgroup>
                  </select>
                </div>
              </div>
            </div>

            <!-- Azure OpenAI Section (Advanced) -->
            <div class="settings-section" id="azureSettingsSection">
              <h3 class="settings-section-title">Azure OpenAI (Advanced)</h3>
              <div class="settings-item-description" style="margin-bottom: 16px;">
                Enable Azure OpenAI as an alternative provider. Requires your own Azure OpenAI deployment.
              </div>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Enable Azure OpenAI</div>
                  <div class="settings-item-description">Show Azure deployments in model selection dropdowns</div>
                </div>
                <div class="settings-item-control">
                  <div class="toggle-switch" id="azureEnabledToggle">
                    <div class="toggle-switch-thumb"></div>
                  </div>
                </div>
              </div>

              <!-- Azure Deployments Management (shown when enabled) -->
              <div id="azureDeploymentsContainer" style="display: none;">
                <div class="settings-item" style="flex-direction: column; align-items: stretch;">
                  <div class="settings-item-info" style="margin-bottom: 12px;">
                    <div class="settings-item-label">Azure Deployments</div>
                    <div class="settings-item-description">Configure your Azure OpenAI model deployments. Each deployment will appear in the model selection dropdowns.</div>
                  </div>

                  <!-- Deployments List -->
                  <div id="azureDeploymentsList" class="azure-deployments-list">
                    <div class="azure-deployment-empty" id="azureDeploymentEmpty">
                      <span style="color: var(--text-secondary);">No deployments configured. Click "Add Deployment" to get started.</span>
                    </div>
                  </div>

                  <!-- Add Deployment Button -->
                  <button class="btn-secondary" id="addAzureDeploymentBtn" style="margin-top: 12px; align-self: flex-start;">
                    <span style="margin-right: 6px;">+</span> Add Deployment
                  </button>
                </div>

                <!-- Azure Endpoint Configuration -->
                <div class="settings-item" style="margin-top: 16px;">
                  <div class="settings-item-info">
                    <div class="settings-item-label">Azure Endpoint</div>
                    <div class="settings-item-description">Your Azure OpenAI resource endpoint (e.g., https://your-resource.openai.azure.com)</div>
                  </div>
                  <div class="settings-item-control" style="flex: 1; max-width: 400px;">
                    <input type="text" class="settings-input" id="azureEndpointInput" placeholder="https://your-resource.openai.azure.com">
                  </div>
                </div>
              </div>
            </div>

            <!-- Transcription Provider Section -->
            <div class="settings-section">
              <h3 class="settings-section-title">Transcription Provider</h3>
              <div class="settings-item-description" style="margin-bottom: 16px;">
                Choose which service to use for transcribing meeting audio to text.
              </div>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Transcription Service</div>
                  <div class="settings-item-description">Service used to convert speech to text</div>
                </div>
                <div class="settings-item-control">
                  <select class="settings-select" id="transcriptionProviderSelect">
                    <option value="assemblyai">AssemblyAI</option>
                    <option value="deepgram">Deepgram</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <div class="settings-panel" id="securityPanel" style="display: none;">
            <!-- API Key Management Section -->
            <div class="settings-section">
              <h3 class="settings-section-title">API Key Management</h3>
              <div class="settings-item-description" style="margin-bottom: 16px;">
                Securely store API keys in Windows Credential Manager. Keys are encrypted and protected by your Windows account.
              </div>

              <!-- Migration Notice -->
              <div class="migration-notice" id="migrationNotice" style="display: none;">
                <div class="migration-notice-icon">‚ö†Ô∏è</div>
                <div class="migration-notice-content">
                  <strong>Migration Required</strong>
                  <p>We detected API keys in your .env file. Click "Migrate Keys" to move them to secure storage.</p>
                  <button class="btn-primary" id="migrateKeysBtn">Migrate Keys from .env</button>
                </div>
              </div>

              <!-- API Keys Table -->
              <div class="api-keys-container">
                <table class="api-keys-table">
                  <thead>
                    <tr>
                      <th>Service</th>
                      <th>Key</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="apiKeysTableBody">
                    <tr>
                      <td colspan="4" style="text-align: center; padding: 32px;">
                        <div class="spinner"></div>
                        <p style="margin-top: 12px; color: var(--text-secondary);">Loading keys...</p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

          </div>

          <div class="settings-panel" id="routingPanel" style="display: none;">
            <div class="settings-section">
              <h3 class="settings-section-title">Routing Configuration</h3>
              <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Configure where meeting notes are saved based on participant email addresses. Define clients, industry contacts, and internal team routing rules.
              </p>

              <div class="routing-editor-container">
                <!-- Organization List Sidebar -->
                <div class="routing-list-sidebar">
                  <div class="routing-list-header">
                    <h4>Organizations</h4>
                  </div>

                  <div class="routing-list-scroll" id="routingOrganizationList">
                    <p style="text-align: center; color: var(--text-secondary); padding: 20px;">Loading...</p>
                  </div>

                  <div class="routing-list-actions">
                    <button id="newOrganizationBtn" title="Add new organization">+ Add Org</button>
                    <button id="deleteOrganizationBtn" disabled title="Delete selected organization">Delete</button>
                  </div>
                </div>

                <!-- Editor/Test Main Area -->
                <div class="routing-editor-main">
                  <div class="routing-editor-toolbar">
                    <input type="text" id="routingFileNameInput" value="routing.yaml" readonly />
                    <div class="routing-toolbar-actions">
                      <button id="refreshRoutingBtn" class="btn-secondary" title="Reload configuration from disk">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" fill="currentColor"/>
                        </svg>
                        Refresh
                      </button>
                      <button id="undoRoutingBtn" class="btn-secondary" title="Restore from backup">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z" fill="currentColor"/>
                        </svg>
                        Undo
                      </button>
                      <button id="validateRoutingBtn" class="btn-secondary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z" fill="currentColor"/>
                        </svg>
                        Validate
                      </button>
                      <button id="saveRoutingBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z" fill="currentColor"/>
                        </svg>
                        Save
                      </button>
                    </div>
                  </div>

                  <div class="routing-editor-tabs">
                    <div class="routing-editor-tab active" id="routingEditorTabBtn">Editor</div>
                    <div class="routing-editor-tab" id="routingTestTabBtn">Test Routing</div>
                  </div>

                  <div class="routing-editor-content">
                    <div id="routingEditorTabContent" style="display: block; width: 100%; height: 100%;">
                      <div id="routingMonacoContainer"></div>
                    </div>

                    <div id="routingTestTabContent" style="display: none; padding: 20px;">
                      <h4 style="margin-bottom: 16px;">Test Routing Preview</h4>
                      <p style="color: var(--text-secondary); margin-bottom: 16px;">Enter participant email addresses to see where the meeting would be saved.</p>

                      <div class="routing-test-input-group">
                        <label for="routingTestEmailInput">Participant Emails (comma-separated)</label>
                        <input type="text" id="routingTestEmailInput" placeholder="e.g., john@example.com, jane@company.com" />
                      </div>

                      <button id="runRoutingTestBtn" class="btn btn-secondary" style="margin-top: 12px;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M8 5v14l11-7z" fill="currentColor"/>
                        </svg>
                        Run Test
                      </button>

                      <div id="routingTestResults" style="margin-top: 24px; display: none;">
                        <h5 style="margin-bottom: 12px;">Routing Result:</h5>
                        <div id="routingTestOutput" class="routing-test-output"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="settings-panel" id="templatesPanel" style="display: none;">
            <div class="settings-section">
              <h3 class="settings-section-title">Template Editor</h3>
              <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Create and edit summary templates that define how meeting transcripts are summarized.
              </p>

              <!-- Manual template management notice -->
              <div class="info-notice" style="background: var(--bg-secondary); border-radius: 8px; padding: 16px; margin-bottom: 20px; border-left: 4px solid var(--primary-color);">
                <p style="margin: 0 0 8px 0; font-weight: 500; color: var(--text-primary);">Manual Template Management</p>
                <p style="margin: 0; color: var(--text-secondary); font-size: 13px;">
                  Template creation and deletion features are coming soon. In the meantime, you can manage templates manually:
                </p>
                <ul style="margin: 8px 0 0 0; padding-left: 20px; color: var(--text-secondary); font-size: 13px;">
                  <li>Templates are stored in your config folder: <code style="background: var(--card-bg); border: 1px solid var(--border-color); padding: 2px 6px; border-radius: 4px; font-family: monospace;">%APPDATA%\jd-notes-things\config\templates\</code></li>
                  <li>Supported formats: <code style="background: var(--card-bg); border: 1px solid var(--border-color); padding: 1px 4px; border-radius: 3px;">.md</code>, <code style="background: var(--card-bg); border: 1px solid var(--border-color); padding: 1px 4px; border-radius: 3px;">.yaml</code>, <code style="background: var(--card-bg); border: 1px solid var(--border-color); padding: 1px 4px; border-radius: 3px;">.json</code>, <code style="background: var(--card-bg); border: 1px solid var(--border-color); padding: 1px 4px; border-radius: 3px;">.txt</code></li>
                  <li>Add new templates by creating files directly in this folder</li>
                  <li>Click "Refresh" in the Templates tab after adding new files</li>
                </ul>
              </div>

              <div class="template-editor-container">
                <!-- Template List Sidebar -->
                <div class="template-list-sidebar">
                  <div class="template-list-header">
                    <h4>Templates</h4>
                  </div>

                  <div class="template-list-scroll" id="templateEditorList">
                    <p style="text-align: center; color: var(--text-secondary); padding: 20px;">Loading...</p>
                  </div>

                  <div class="template-list-actions">
                    <button id="newTemplateBtn">+ New</button>
                    <button id="deleteTemplateBtn" disabled>Delete</button>
                  </div>
                </div>

                <!-- Editor/Preview Main Area -->
                <div class="template-editor-main">
                  <div class="template-editor-toolbar">
                    <input type="text" id="templateNameInput" placeholder="Select a template..." readonly />
                    <button id="saveTemplateBtn" disabled>Save Template</button>
                  </div>

                  <div class="template-editor-tabs">
                    <div class="template-editor-tab active" id="editorTabBtn">Editor</div>
                    <div class="template-editor-tab" id="previewTabBtn">Preview</div>
                  </div>

                  <div class="template-editor-content">
                    <div id="editorTabContent" style="display: block; width: 100%; height: 100%;">
                      <div id="monacoEditorContainer"></div>
                    </div>

                    <div id="previewTabContent" style="display: none;">
                      <p style="text-align: center; color: var(--text-secondary); margin-top: 60px;">Select a template to preview</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- VC-2: Vocabulary Management Panel -->
          <div class="settings-panel" id="vocabularyPanel" style="display: none;">
            <div class="settings-section">
              <h3 class="settings-section-title">Vocabulary Settings</h3>
              <p class="settings-section-description">
                Add custom vocabulary to improve transcription accuracy. Spelling corrections fix common mishearings,
                while keyword boosts increase the probability of recognizing specific terms.
              </p>

              <!-- Scope selector tabs -->
              <div class="vocabulary-scope-tabs">
                <button class="vocabulary-scope-tab active" data-scope="global">Global Vocabulary</button>
                <button class="vocabulary-scope-tab" data-scope="client">Client-Specific</button>
              </div>

              <!-- Client selector (hidden when global is selected) -->
              <div id="vocabularyClientSelector" class="vocabulary-client-selector" style="display: none;">
                <label for="vocabularyClientSelect">Select Client:</label>
                <select id="vocabularyClientSelect">
                  <option value="">-- Select a client --</option>
                </select>
                <button id="addNewClientVocab" class="btn btn-secondary btn-sm">+ New Client</button>
              </div>
            </div>

            <!-- Spelling Corrections Section -->
            <div class="settings-section">
              <h3 class="settings-section-title">
                Spelling Corrections
                <span class="settings-section-badge" id="spellingCount">0</span>
              </h3>
              <p class="settings-section-description">
                Map common mishearings to correct spellings. These are applied during transcription (AssemblyAI).
              </p>

              <div class="vocabulary-add-form" id="spellingAddForm">
                <div class="vocabulary-add-row">
                  <input type="text" id="spellingFrom" placeholder="Incorrect spellings (comma-separated)" class="settings-input" />
                  <span class="vocabulary-arrow">‚Üí</span>
                  <input type="text" id="spellingTo" placeholder="Correct spelling" class="settings-input" />
                  <button id="addSpellingBtn" class="btn btn-primary btn-sm">Add</button>
                </div>
              </div>

              <div class="vocabulary-list" id="spellingList">
                <div class="vocabulary-empty">No spelling corrections defined</div>
              </div>
            </div>

            <!-- Keyword Boosts Section -->
            <div class="settings-section">
              <h3 class="settings-section-title">
                Keyword Boosts
                <span class="settings-section-badge" id="keywordCount">0</span>
              </h3>
              <p class="settings-section-description">
                Increase the probability of recognizing specific words. Higher intensity = stronger boost (1-10).
                These are used by Deepgram.
              </p>

              <div class="vocabulary-add-form" id="keywordAddForm">
                <div class="vocabulary-add-row">
                  <input type="text" id="keywordWord" placeholder="Word or phrase" class="settings-input" />
                  <input type="number" id="keywordIntensifier" placeholder="Boost (1-10)" class="settings-input vocabulary-intensifier" min="1" max="10" value="5" />
                  <button id="addKeywordBtn" class="btn btn-primary btn-sm">Add</button>
                </div>
              </div>

              <div class="vocabulary-list" id="keywordList">
                <div class="vocabulary-empty">No keyword boosts defined</div>
              </div>
            </div>

            <!-- Import/Export Section -->
            <div class="settings-section">
              <h3 class="settings-section-title">Import / Export</h3>
              <div class="vocabulary-actions">
                <button id="vocabularyExportBtn" class="btn btn-secondary">Export Vocabulary</button>
                <button id="vocabularyImportBtn" class="btn btn-secondary">Import Vocabulary</button>
                <button id="vocabularyReloadBtn" class="btn btn-secondary">Reload from Disk</button>
              </div>
            </div>
          </div>

          <!-- Phase 10.8.2: Transcript Patterns Editor -->
          <div class="settings-panel" id="patternsPanel" style="display: none;">
            <div class="settings-section">
              <h3 class="settings-section-title">Transcript Pattern Testing</h3>
              <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Test and edit patterns for parsing transcript files. Patterns are defined in YAML and use regex to extract speaker names and text.
              </p>

              <div class="pattern-editor-container">
                <!-- Pattern Editor (Monaco) -->
                <div class="pattern-editor-left">
                  <div class="pattern-editor-header">
                    <h4>Pattern Configuration (YAML)</h4>
                    <div style="display: flex; gap: 8px;">
                      <button class="btn btn-primary btn-sm" id="patternEditorSaveBtn">Save Patterns</button>
                    </div>
                  </div>
                  <div id="patternEditorMonaco" style="height: 400px; border: 1px solid var(--border-color); border-radius: 4px;"></div>
                </div>

                <!-- Test Area -->
                <div class="pattern-editor-right">
                  <div class="pattern-test-header">
                    <h4>Test Sample</h4>
                    <div class="pattern-test-controls">
                      <select id="patternTestSampleSelect" class="settings-input" style="width: 150px;">
                        <option value="inline">Inline Format</option>
                        <option value="header">Header Format</option>
                        <option value="krisp">Krisp Format</option>
                        <option value="markdown">Markdown</option>
                        <option value="timestamp">Timestamp</option>
                      </select>
                      <button class="btn btn-secondary btn-sm" id="patternEditorTestBtn">Test Parse</button>
                    </div>
                  </div>

                  <div class="pattern-test-sample">
                    <textarea id="patternTestSampleText"
                              placeholder="Paste sample transcript text here to test patterns..."
                              rows="8"></textarea>
                  </div>

                  <!-- Results -->
                  <div class="pattern-test-results">
                    <h4>Parse Results</h4>

                    <!-- Statistics -->
                    <div id="patternTestStats" style="margin-bottom: 16px; display: block; width: 100%;"></div>

                    <!-- Warnings -->
                    <div id="patternTestWarnings" style="margin-bottom: 16px; display: block; width: 100%;"></div>

                    <!-- Speaker Distribution -->
                    <div id="patternTestSpeakerDist" style="margin-bottom: 16px; display: block; width: 100%;"></div>

                    <!-- Sample Entries (collapsed by default) -->
                    <details style="margin-bottom: 16px;">
                      <summary style="cursor: pointer; font-weight: 500; margin-bottom: 8px;">Sample Entries</summary>
                      <div id="patternTestSampleEntries"></div>
                    </details>
                  </div>

                  <!-- Error Display -->
                  <div id="patternTestError" class="pattern-error" style="display: none; margin-top: 16px;"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Phase 10.7: Notification Preferences -->
          <div class="settings-panel" id="notificationsPanel" style="display: none;">
            <div class="settings-section">
              <h3 class="settings-section-title">Notification Preferences</h3>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Enable Toast Notifications</div>
                  <div class="settings-item-description">Show desktop notifications for recording events</div>
                </div>
                <div class="settings-item-control">
                  <div class="toggle-switch" id="enableToastsToggle">
                    <div class="toggle-switch-thumb"></div>
                  </div>
                </div>
              </div>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Enable Notification Sounds</div>
                  <div class="settings-item-description">Play sounds with notifications</div>
                </div>
                <div class="settings-item-control">
                  <div class="toggle-switch" id="enableSoundsToggle">
                    <div class="toggle-switch-thumb"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Phase 10.7: Keyboard Shortcuts -->
          <div class="settings-panel" id="shortcutsPanel" style="display: none;">
            <div class="settings-section">
              <h3 class="settings-section-title">Global Keyboard Shortcuts</h3>
              <div class="settings-item-description" style="margin-bottom: 16px;">
                Global shortcuts work even when the app is not focused. Changes require app restart.
              </div>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Record Meeting</div>
                  <div class="settings-item-description">Start or join a meeting recording</div>
                </div>
                <div class="settings-item-control">
                  <input type="text" class="settings-input" id="startStopShortcut" placeholder="CommandOrControl+Shift+R" />
                </div>
              </div>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Quick Note</div>
                  <div class="settings-item-description">Start in-person meeting note immediately</div>
                </div>
                <div class="settings-item-control">
                  <input type="text" class="settings-input" id="quickRecordShortcut" placeholder="CommandOrControl+Shift+Q" />
                </div>
              </div>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Stop Recording</div>
                  <div class="settings-item-description">Stop active recording</div>
                </div>
                <div class="settings-item-control">
                  <input type="text" class="settings-input" id="stopRecordingShortcut" placeholder="CommandOrControl+Shift+S" />
                </div>
              </div>

              <div class="info-box">
                <strong>Shortcut Format:</strong>
                <ul style="margin: 8px 0 0 0; padding-left: 20px;">
                  <li><code>CommandOrControl</code> - Cmd (Mac) or Ctrl (Windows/Linux)</li>
                  <li><code>Shift</code>, <code>Alt</code>, <code>Option</code> - Modifier keys</li>
                  <li>Single letter/number for the key (e.g., <code>R</code>, <code>Q</code>)</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- v1.2: Stream Deck Integration -->
          <div class="settings-panel" id="streamdeckPanel" style="display: none;">
            <div class="settings-section">
              <h3 class="settings-section-title">Stream Deck Integration</h3>
              <p class="settings-section-description">
                Control meeting recordings from your Elgato Stream Deck. Enable the WebSocket server to allow Stream Deck plugins to communicate with the app.
              </p>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Enable Stream Deck</div>
                  <div class="settings-item-description">Allow Stream Deck plugins to control recordings via WebSocket</div>
                </div>
                <div class="settings-item-control">
                  <label class="toggle-switch">
                    <input type="checkbox" id="streamDeckEnabled" />
                    <span class="toggle-slider"></span>
                  </label>
                </div>
              </div>

              <div class="settings-item" id="streamDeckStatusItem" style="display: none;">
                <div class="settings-item-info">
                  <div class="settings-item-label">Connection Status</div>
                  <div class="settings-item-description" id="streamDeckStatusText">Checking...</div>
                </div>
                <div class="settings-item-control">
                  <button class="btn btn-sm" id="refreshStreamDeckStatus">Refresh</button>
                </div>
              </div>

              <div class="info-box" id="streamDeckInfoBox" style="display: none;">
                <strong>WebSocket Endpoint:</strong>
                <code id="streamDeckEndpoint">ws://localhost:13373/streamdeck</code>
                <br><br>
                <strong>Protocol:</strong>
                <ul style="margin: 8px 0 0 0; padding-left: 20px;">
                  <li>Send <code>{"action": "startRecording"}</code> to start recording</li>
                  <li>Send <code>{"action": "stopRecording"}</code> to stop recording</li>
                  <li>Send <code>{"action": "getStatus"}</code> to get current status</li>
                  <li>Receive events: <code>connected</code>, <code>recordingStarted</code>, <code>recordingStopped</code>, <code>statusUpdate</code></li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Phase 10.7: Logs & Diagnostics -->
          <div class="settings-panel" id="logsPanel" style="display: none;">
            <div class="settings-section">
              <h3 class="settings-section-title">Application Logs</h3>

              <div style="margin-bottom: 16px; display: flex; gap: 8px; flex-wrap: wrap;">
                <button class="btn btn-primary" id="refreshLogsBtn">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 4px;">
                    <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" fill="currentColor"/>
                  </svg>
                  Refresh
                </button>
                <button class="btn" id="clearLogsBtn">Clear Logs</button>
                <button class="btn" id="openLogFileBtn">Open Log File</button>
                <select class="settings-select" id="logLevelFilter" style="width: auto;">
                  <option value="all">All Levels</option>
                  <option value="error">Errors Only</option>
                  <option value="warn">Warnings</option>
                  <option value="info">Info</option>
                  <option value="debug">Debug</option>
                  <option value="datasync">Data Sync</option>
                </select>
                <input type="text" class="settings-input" id="logTextFilter" placeholder="Filter by text" style="width: 220px; height: 32px;">
                <button class="btn" id="clearLogFilterBtn" style="padding: 0 8px;" title="Clear filter">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="currentColor"/>
                  </svg>
                </button>
              </div>

              <div class="log-viewer" id="logViewer">
                <div class="log-viewer-content" id="logViewerContent">
                  <div style="color: var(--text-secondary); text-align: center; padding: 40px;">
                    Click "Refresh" to load logs
                  </div>
                </div>
              </div>

              <div class="log-viewer-footer">
                <span id="logStats">0 lines</span>
                <span id="logPath" style="color: var(--text-secondary); font-size: 12px;"></span>
              </div>
            </div>
          </div>

          <div class="settings-panel" id="advancedPanel" style="display: none;">
            <div class="settings-section">
              <h3 class="settings-section-title">Backup & Restore</h3>
              <p class="settings-section-description" style="color: var(--text-secondary); font-size: 13px; margin-bottom: 16px;">
                Export all configuration including routing rules, templates, vocabulary, speaker mappings, and app preferences.
                API keys are NOT exported for security.
              </p>

              <div class="settings-action-group">
                <button class="settings-action-btn" id="exportAllSettingsBtn">
                  <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" fill="currentColor" transform="rotate(180 12 12)"/>
                  </svg>
                  <span>Export All Settings</span>
                </button>
                <button class="settings-action-btn" id="importAllSettingsBtn">
                  <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" fill="currentColor"/>
                  </svg>
                  <span>Import Settings</span>
                </button>
              </div>
              <div id="exportStatus" style="margin-top: 12px; font-size: 13px; color: var(--text-secondary); display: none;"></div>
            </div>

            <!-- RS-2: Data Maintenance Section -->
            <div class="settings-section">
              <h3 class="settings-section-title">Data Maintenance</h3>
              <p class="settings-section-description">Tools for maintaining sync between the app and your Obsidian vault.</p>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Refresh Obsidian Links</div>
                  <div class="settings-item-description">Scan vault for moved/renamed notes and update internal links. Run this after reorganizing your vault.</div>
                </div>
                <div class="settings-item-control" style="display: flex; gap: 8px; align-items: center;">
                  <button class="btn btn-secondary" id="refreshObsidianLinksBtn">Refresh Links</button>
                  <span class="settings-item-status" id="refreshLinksStatus"></span>
                </div>
              </div>
            </div>

            <div class="settings-section">
              <h3 class="settings-section-title">Developer</h3>

              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Debug Mode</div>
                  <div class="settings-item-description">Show additional debugging information</div>
                </div>
                <div class="settings-item-control">
                  <div class="toggle-switch" id="debugModeToggle">
                    <div class="toggle-switch-thumb"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="settings-panel" id="aboutPanel" style="display: none;">
            <div class="settings-section">
              <div class="about-info">
                <h3>JD Notes Things</h3>
                <p class="version" id="appVersion">v1.2.0</p>
                <p>AI-Powered Meeting Transcription & Summarization</p>
                <p style="margin-top: 12px;">
                  <a href="#" id="githubRepoLink" style="color: var(--primary-color); text-decoration: none; display: inline-flex; align-items: center; gap: 6px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                    </svg>
                    GitHub Repository
                  </a>
                </p>
              </div>
            </div>

            <div class="settings-section">
              <h3 class="settings-section-title">System Information</h3>
              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Electron Version</div>
                </div>
                <div class="settings-item-control">
                  <span style="font-family: monospace; color: var(--text-secondary);" id="electronVersion">-</span>
                </div>
              </div>
              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Node Version</div>
                </div>
                <div class="settings-item-control">
                  <span style="font-family: monospace; color: var(--text-secondary);" id="nodeVersion">-</span>
                </div>
              </div>
              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Chrome Version</div>
                </div>
                <div class="settings-item-control">
                  <span style="font-family: monospace; color: var(--text-secondary);" id="chromeVersion">-</span>
                </div>
              </div>
            </div>

            <div class="settings-section">
              <h3 class="settings-section-title">Updates</h3>
              <div class="settings-item">
                <div class="settings-item-info">
                  <div class="settings-item-label">Check for Updates</div>
                  <div class="settings-item-description" id="updateStatus">Auto-updates are enabled. Click to check manually.</div>
                </div>
                <div class="settings-item-control">
                  <button class="btn btn-secondary" id="checkForUpdatesBtn">Check Now</button>
                </div>
              </div>
            </div>
          </div>
        </div>
    </div>

    <!-- Contacts Full-Page View (CS-1) -->
    <div id="contactsView" class="contacts-full-page" style="display: none;">
        <div class="modal-header">
          <h2>Contacts</h2>
          <button class="modal-close" id="closeContacts">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="currentColor"/>
            </svg>
          </button>
        </div>

        <div class="contacts-content">
          <!-- Search Bar -->
          <div class="contacts-search-bar">
            <svg class="search-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="currentColor"/>
            </svg>
            <input type="text" id="contactSearchInput" placeholder="Search contacts by name or email..." />
            <button class="refresh-btn" id="refreshContactsBtn" title="Refresh contacts from Google">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" fill="currentColor"/>
              </svg>
            </button>
          </div>

          <div class="contacts-main">
            <!-- Contact List -->
            <div class="contacts-list-panel">
              <div class="contacts-list-header">
                <span id="contactsCount">0 contacts</span>
              </div>
              <div id="contactsList" class="contacts-list">
                <!-- Contact items will be rendered here -->
                <div class="contacts-loading">
                  <span>Loading contacts...</span>
                </div>
              </div>
            </div>

            <!-- Contact Detail Panel -->
            <div class="contacts-detail-panel" id="contactDetailPanel">
              <div class="contact-detail-empty">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" fill="currentColor"/>
                </svg>
                <p>Select a contact to view details</p>
              </div>
              <div class="contact-detail-content" id="contactDetailContent" style="display: none;">
                <!-- Contact details will be rendered here -->
              </div>
            </div>
          </div>
        </div>
    </div>

    <!-- Quick Contact Search Modal (CS-2) -->
    <div class="quick-search-overlay" id="quickSearchOverlay" style="display: none;">
      <div class="quick-search-modal">
        <div class="quick-search-input-wrapper">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="currentColor"/>
          </svg>
          <input type="text" id="quickSearchInput" placeholder="Search contacts..." autocomplete="off" />
          <kbd class="quick-search-shortcut">Esc</kbd>
        </div>
        <div class="quick-search-results" id="quickSearchResults">
          <div class="quick-search-hint">
            <span>Type to search contacts by name, email, or company</span>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
