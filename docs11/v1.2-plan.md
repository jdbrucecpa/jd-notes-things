# v1.2 Development Plan

## Release Overview

**Version:** 1.2.0
**Branch:** `v1.2`
**Focus:** Calendar/Recording UX, Filters & Saved Views, Stream Deck Integration

This is a focused release with 3 core features that improve the day-to-day user experience of recording and managing meetings.

---

## Feature 1: Calendar/Recording UX Improvements

**Goal:** Fix broken meeting cards, implement auto-start recording, and add a Krisp-style floating recording widget.

### 1.1 Fix Google Calendar Meeting Cards

**Problem:** The "Record Meeting" and "Join Meeting" buttons don't work. Meeting cards lack a distinct meeting link and don't show the date.

**Deliverables:**

- [x] Fix "Join Meeting" button to open the meeting link (Zoom/Teams/Meet)
- [x] Fix "Record Meeting" button to start recording for that specific meeting
- [x] Add distinct, clickable meeting link in the card UI
- [x] Include the date in addition to time on meeting cards
- [x] Ensure meeting card displays correct info when pulled from Google Calendar

**Files to modify:**

- `src/renderer.js` - Meeting card rendering (`createMeetingCard()` function)
- `src/index.html` - Meeting card template structure
- `src/index.css` - Meeting card styling
- `src/main.js` - IPC handlers for opening meeting links

**Implementation Notes:**

- The `meetingLink` is already extracted in `GoogleCalendar.js:_extractMeetingLink()`
- Need to wire up the buttons to use this link
- Add `shell.openExternal()` for opening meeting URLs

### 1.2 Recording Widget (Krisp-style)

**Goal:** A floating mini-window that appears when a meeting is detected, allowing quick start/stop of recording.

**Deliverables:**

- [x] Create new `RecordingWidget` BrowserWindow (always-on-top, frameless)
- [x] Small UI showing: meeting title, recording status indicator, start/stop button
- [x] Draggable window (can be positioned anywhere)
- [x] Visual feedback: recording indicator (red dot/pulse), elapsed time
- [x] Settings option to enable/disable widget popup behavior
- [x] Widget syncs state with main window recording controls

**New Files:**

- `src/widget.html` - Recording widget HTML
- `src/widget.css` - Widget styling
- `src/widget.js` - Widget renderer logic
- `src/main/windows/RecordingWidget.js` - Widget window management

**Files to modify:**

- `src/main.js` - Create/manage widget window
- `src/renderer/appSettings.js` - Add widget popup setting
- `src/preload.js` - Add widget IPC methods

**Implementation Notes:**

- Use `BrowserWindow` with `frame: false`, `alwaysOnTop: true`, `transparent: true`
- Recommended size: ~280x80px
- Communication between main window and widget via IPC
- Widget should appear near system tray area by default

### 1.3 Auto-Start Recording

**Goal:** Automatically start recording when a calendar meeting starts and a meeting platform is detected.

**Deliverables:**

- [x] Add setting: "Auto-start recording when meeting begins" (default: off)
- [x] Add setting: "Show popup when meeting detected" (for when auto-start is off)
- [x] Meeting detection polling (check every 30 seconds if calendar meeting is due)
- [x] When calendar time hits:
  - If meeting platform detected + auto-start on → start recording
  - If meeting platform detected + auto-start off → show widget asking to start
  - If no meeting detected + calendar time hit → show widget asking if user wants to start
- [x] Handle overlapping meetings: show dialog asking which meeting to record

**Files to modify:**

- `src/main.js` - Meeting detection polling, auto-start logic
- `src/main/integrations/GoogleCalendar.js` - Method to get "current" meeting
- `src/renderer/appSettings.js` - New settings for auto-start and popup behavior

**Implementation Notes:**

- Poll every 30 seconds: `setInterval(checkForMeetingStart, 30000)`
- Grace period: trigger if meeting start time is within ±2 minutes
- Store "already prompted" state to avoid repeated popups
- For overlapping meetings, show a simple dialog with meeting titles and times

---

## Feature 2: Filters & Saved Views

**Goal:** Add filtering on the main page by company, contact, platform, and sync status. Allow users to save custom filter combinations as "views."

### 2.1 Simple Filters

**Deliverables:**

- [x] Add filter dropdown: Company (extracted from routing/organization)
- [x] Add filter dropdown: Contact (from meeting participants)
- [x] Add filter dropdown: Platform (Zoom, Teams, Google Meet, etc.)
- [x] Add filter toggle: Synced to Obsidian / Not synced
- [x] Filters combine with AND logic
- [x] Filter state persists in localStorage during session
- [x] Clear filters button to reset all

**Files to modify:**

- `src/renderer.js` - Filter UI, filter logic in `filterMeetings()`
- `src/index.html` - Filter controls HTML
- `src/index.css` - Filter styling

**Implementation Notes:**

- Extract unique companies from `meetings.organization` field
- Extract unique contacts from `meetings.participants` array
- Platform is already available in meeting data
- Build filter dropdowns dynamically based on available data

### 2.2 Saved Views

**Goal:** Allow users to create, save, and quickly switch between custom filter combinations.

**Deliverables:**

- [x] "Save View" button to save current filter state with a name
- [x] Views dropdown to select saved views
- [x] Views stored in localStorage
- [x] Predefined views: "All Meetings", "Not Synced to Obsidian"
- [x] Edit/delete saved views
- [x] View indicator showing current active view

**New Files:**

- `src/main/storage/ViewsManager.js` - CRUD for saved views

**Files to modify:**

- `src/renderer.js` - Views UI, view selection
- `src/main.js` - IPC handlers for views CRUD
- `src/preload.js` - View management IPC methods
- `src/index.html` - Views dropdown and save button

**Data Structure:**

```json
{
  "views": [
    {
      "id": "uuid",
      "name": "Alman Partners Meetings",
      "filters": {
        "company": "Alman Partners",
        "contact": null,
        "platform": null,
        "syncedToObsidian": null
      },
      "createdAt": "2024-01-15T10:00:00Z"
    }
  ]
}
```

---

## Feature 3: Elgato Stream Deck Plugin

**Goal:** Create a Stream Deck plugin for start/stop recording with visual feedback.

### 3.1 Stream Deck Plugin Architecture

**Deliverables:**

- [ ] Create Stream Deck plugin package structure (deferred - WebSocket protocol ready)
- [x] Implement WebSocket server in main app for Stream Deck communication
- [x] Start Recording action (icon changes when recording)
- [x] Stop Recording action
- [x] Visual feedback: icon states for idle/recording/error
- [ ] Plugin configuration via Stream Deck software (deferred)

**New Files:**

- `streamdeck-plugin/` - Plugin directory structure
  - `manifest.json` - Plugin manifest
  - `com.jdnotesthings.sdPlugin/` - Plugin bundle
    - `plugin.js` - Plugin JavaScript
    - `actions/` - Action definitions
    - `images/` - Icon assets (idle, recording, error states)
- `src/main/integrations/StreamDeckServer.js` - WebSocket server

**Files to modify:**

- `src/main.js` - Initialize Stream Deck server on app start

**Implementation Notes:**

1. **Communication Protocol:** WebSocket on localhost (port TBD, e.g., 13374)
2. **Message Types:**

   ```json
   // Plugin → App
   { "action": "startRecording" }
   { "action": "stopRecording" }
   { "action": "getStatus" }

   // App → Plugin
   { "event": "statusUpdate", "data": { "isRecording": true, "meetingTitle": "..." } }
   ```

3. **Icon States:**
   - Idle (gray/blue microphone)
   - Recording (red pulsing microphone)
   - Error (yellow warning icon)

### 3.2 Stream Deck Settings

**Deliverables:**

- [x] Add settings section for Stream Deck integration
- [x] Toggle to enable/disable Stream Deck server
- [x] Display connection status
- [ ] Port configuration (advanced) - deferred

**Files to modify:**

- `src/renderer/appSettings.js` - Stream Deck settings UI
- `src/main.js` - Server enable/disable based on settings

---

## Implementation Phases

### Phase 1: Calendar/Recording UX (Priority: High)

1. Fix meeting card buttons (Join Meeting, Record Meeting)
2. Add date display to meeting cards
3. Implement recording widget
4. Implement auto-start logic and settings

### Phase 2: Filters & Saved Views (Priority: High)

1. Add filter dropdowns (company, contact, platform, sync status)
2. Implement filter logic
3. Add saved views functionality

### Phase 3: Stream Deck Integration (Priority: Medium)

1. Create WebSocket server
2. Build Stream Deck plugin
3. Add settings UI

---

## Settings Changes Summary

New settings to add in Notifications/Recording tab:

| Setting               | Type    | Default | Description                                       |
| --------------------- | ------- | ------- | ------------------------------------------------- |
| `autoStartRecording`  | boolean | false   | Auto-start recording when calendar meeting begins |
| `showRecordingWidget` | boolean | true    | Show floating widget when meeting detected        |
| `streamDeckEnabled`   | boolean | false   | Enable Stream Deck WebSocket server               |
| `streamDeckPort`      | number  | 13374   | WebSocket port for Stream Deck                    |

---

## Testing Checklist

### Calendar/Recording UX

- [ ] Join Meeting button opens correct URL in browser
- [ ] Record Meeting button starts recording for specific meeting
- [ ] Meeting cards show date and time
- [ ] Recording widget appears when meeting starts (if enabled)
- [ ] Recording widget can be dragged and repositioned
- [ ] Auto-start works when calendar meeting begins
- [ ] Overlapping meetings prompt user to choose
- [ ] Widget state syncs with main window

### Filters & Saved Views

- [ ] Company filter shows all unique companies
- [ ] Contact filter shows all unique contacts
- [ ] Platform filter shows all platforms in use
- [ ] Sync status filter works correctly
- [ ] Multiple filters combine correctly (AND logic)
- [ ] Views can be saved with custom names
- [ ] Saved views can be selected from dropdown
- [ ] Views can be edited and deleted
- [ ] Filter state persists during session

### Stream Deck

- [ ] WebSocket server starts when enabled
- [ ] Stream Deck plugin connects successfully
- [ ] Start recording action works
- [ ] Stop recording action works
- [ ] Icon state updates in real-time
- [ ] Server stops when disabled in settings

---

## Risk Assessment

| Risk                                        | Impact | Mitigation                                                         |
| ------------------------------------------- | ------ | ------------------------------------------------------------------ |
| Stream Deck SDK complexity                  | Medium | Start with simple WebSocket approach; official SDK if needed later |
| Meeting detection false positives           | Low    | Add grace period, require active meeting platform detection        |
| Widget window management on Windows         | Medium | Test extensively; use electron-positioner for placement            |
| Filter performance with large meeting lists | Low    | Debounce filter input; consider pagination for 500+ meetings       |

---

## Success Criteria

1. **Calendar UX:** Users can join and record meetings directly from calendar cards with one click
2. **Recording Widget:** Users can start/stop recording from anywhere on screen
3. **Auto-Start:** Hands-free recording for scheduled meetings
4. **Filters:** Users can quickly find specific meetings by company, contact, or platform
5. **Saved Views:** Users can create and switch between custom meeting lists
6. **Stream Deck:** Physical button control for recording with visual feedback

---

## Dependencies

- No new npm packages required for Features 1 & 2
- Stream Deck plugin: May need `ws` package for WebSocket server (check if already included)

---

## Out of Scope for v1.2

- HubSpot integration (deferred)
- Gmail integration (deferred)
- SQLite migration (deferred)
- Transcription upgrades (deferred)
- Real-time streaming transcription (deferred)
